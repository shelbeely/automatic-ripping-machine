<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= typeof title !== 'undefined' ? title : 'Job Detail' %></title>
  <%- include('head') %>
</head>
<body class="dark">
  <%- include('nav') %>
  <div class="page">
    <h5>Job Details - #<%= job.job_id %></h5>
    <div class="grid">
      <div class="s12 m6">
        <div class="md3-card">
          <h6 class="md-typescale-title-medium">Job Info</h6>
          <div class="mdc-data-table">
            <div class="mdc-data-table__table-container">
              <table class="mdc-data-table__table" aria-label="Job information">
                <tbody class="mdc-data-table__content">
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Title</strong></td><td class="mdc-data-table__cell"><%= job.title || 'Unknown' %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Year</strong></td><td class="mdc-data-table__cell"><%= job.year || 'N/A' %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Type</strong></td><td class="mdc-data-table__cell"><%= job.disctype %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Video Type</strong></td><td class="mdc-data-table__cell"><%= job.video_type || 'N/A' %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Status</strong></td><td class="mdc-data-table__cell"><span class="status-chip <%= job.status === 'success' ? 'success' : (job.status === 'fail' ? 'error' : 'primary') %>"><%= job.status %></span></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Device</strong></td><td class="mdc-data-table__cell"><%= job.devpath %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>Started</strong></td><td class="mdc-data-table__cell"><%= new Date(job.start_time).toLocaleString() %></td></tr>
                  <tr class="mdc-data-table__row"><td class="mdc-data-table__cell"><strong>IMDB</strong></td><td class="mdc-data-table__cell"><%= job.imdb_id || 'N/A' %></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="s12 m6">
        <% if (job.poster_url) { %>
          <img src="<%= job.poster_url %>" alt="Poster" style="max-height: 400px; max-width: 100%; border-radius: 0.5rem;">
        <% } %>
      </div>
    </div>
    <% if (typeof tracks !== 'undefined' && tracks.length > 0) { %>
      <div class="md3-card" style="margin-top:1rem;">
        <h6 class="md-typescale-title-medium">Tracks</h6>
        <div class="mdc-data-table">
          <div class="mdc-data-table__table-container">
            <table class="mdc-data-table__table" aria-label="Tracks">
              <thead>
                <tr class="mdc-data-table__header-row">
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">#</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Length</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Aspect</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">FPS</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Main</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Ripped</th>
                  <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Filename</th>
                </tr>
              </thead>
              <tbody class="mdc-data-table__content">
                <% tracks.forEach(function(track) { %>
                  <tr class="mdc-data-table__row">
                    <td class="mdc-data-table__cell"><%= track.track_number %></td>
                    <td class="mdc-data-table__cell"><%= track.length %></td>
                    <td class="mdc-data-table__cell"><%= track.aspect_ratio %></td>
                    <td class="mdc-data-table__cell"><%= track.fps %></td>
                    <td class="mdc-data-table__cell"><%= track.main_feature ? 'Yes' : 'No' %></td>
                    <td class="mdc-data-table__cell"><%= track.ripped ? 'Yes' : 'No' %></td>
                    <td class="mdc-data-table__cell"><%= track.filename || '' %></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% } %>
    <div style="margin-top:1rem;">
      <a href="/logs?job_id=<%= job.job_id %>"><md-outlined-button>View Logs</md-outlined-button></a>
      <a href="/"><md-filled-button>Back to Home</md-filled-button></a>
    </div>
  </div>
  </div>
  <script>
    var drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
    var topAppBar = mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('.mdc-top-app-bar'));
    topAppBar.setScrollTarget(document.querySelector('.page'));
    topAppBar.listen('MDCTopAppBar:nav', function() {
      drawer.open = !drawer.open;
    });
    if (window.innerWidth >= 993) drawer.open = true;
  </script>
</body>
</html>
