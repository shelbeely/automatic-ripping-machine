<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= typeof title !== 'undefined' ? title : 'ARM' %></title>
  <%- include('head') %>
</head>
<body class="dark">
  <%- include('nav') %>
  <div class="page">
    <h5>Automatic Ripping Machine</h5>
    <div class="grid">
      <div class="s12 m8">
        <div class="md3-card">
          <h6 class="md-typescale-title-medium">Active Jobs</h6>
          <% if (typeof jobs !== 'undefined' && jobs.length > 0) { %>
            <div class="mdc-data-table">
              <div class="mdc-data-table__table-container">
                <table class="mdc-data-table__table" aria-label="Active jobs">
                  <thead>
                    <tr class="mdc-data-table__header-row">
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">ID</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Title</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Type</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Status</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Progress</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Started</th>
                      <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="mdc-data-table__content">
                    <% jobs.forEach(function(job) { %>
                      <tr class="mdc-data-table__row">
                        <td class="mdc-data-table__cell"><a href="/jobdetail?job_id=<%= job.job_id %>"><%= job.job_id %></a></td>
                        <td class="mdc-data-table__cell"><%= job.title || 'Unknown' %></td>
                        <td class="mdc-data-table__cell"><%= job.disctype %></td>
                        <td class="mdc-data-table__cell"><span class="status-chip <%= job.status === 'ripping' ? 'primary' : (job.status === 'transcoding' ? 'secondary' : 'success') %>"><%= job.status %></span></td>
                        <td class="mdc-data-table__cell"><%= job.progress || 'N/A' %></td>
                        <td class="mdc-data-table__cell"><%= new Date(job.start_time).toLocaleString() %></td>
                        <td class="mdc-data-table__cell"><a href="/jobdetail?job_id=<%= job.job_id %>"><md-outlined-button>Details</md-outlined-button></a></td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
            </div>
          <% } else { %>
            <p>No active jobs</p>
          <% } %>
        </div>
      </div>
      <div class="s12 m4">
        <div class="md3-card">
          <h6 class="md-typescale-title-medium">System Info</h6>
          <% if (typeof systemInfo !== 'undefined') { %>
            <p><strong>CPU:</strong> <%= systemInfo.cpu || 'Unknown' %></p>
            <p><strong>Memory:</strong> <%= systemInfo.mem_total || 0 %> GB</p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
  </div>
  <script src="/static/js/app.js"></script>
  <script>
    var drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
    var topAppBar = mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('.mdc-top-app-bar'));
    topAppBar.setScrollTarget(document.querySelector('.page'));
    topAppBar.listen('MDCTopAppBar:nav', function() {
      drawer.open = !drawer.open;
    });
    if (window.innerWidth >= 993) drawer.open = true;
  </script>
</body>
</html>
