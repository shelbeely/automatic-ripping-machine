<!DOCTYPE html>
<html lang="en">
<head>
  <title>ARM - History</title>
  <%- include('head') %>
</head>
<body class="dark">
  <%- include('nav') %>
  <div class="page">
    <h5>Job History</h5>
    <% if (typeof jobs !== 'undefined' && jobs.length > 0) { %>
      <div class="mdc-data-table">
        <div class="mdc-data-table__table-container">
          <table class="mdc-data-table__table" aria-label="Job history">
            <thead>
              <tr class="mdc-data-table__header-row">
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">ID</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Title</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Type</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Status</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Started</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Finished</th>
                <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody class="mdc-data-table__content">
              <% jobs.forEach(function(job) { %>
                <tr class="mdc-data-table__row">
                  <td class="mdc-data-table__cell"><a href="/jobdetail?job_id=<%= job.job_id %>"><%= job.job_id %></a></td>
                  <td class="mdc-data-table__cell"><%= job.title || 'Unknown' %></td>
                  <td class="mdc-data-table__cell"><%= job.disctype %></td>
                  <td class="mdc-data-table__cell"><span class="status-chip <%= job.status === 'success' ? 'success' : 'error' %>"><%= job.status %></span></td>
                  <td class="mdc-data-table__cell"><%= new Date(job.start_time).toLocaleString() %></td>
                  <td class="mdc-data-table__cell"><%= job.stop_time ? new Date(job.stop_time).toLocaleString() : 'N/A' %></td>
                  <td class="mdc-data-table__cell"><a href="/jobdetail?job_id=<%= job.job_id %>"><md-outlined-button>Details</md-outlined-button></a></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    <% } else { %>
      <div class="md3-alert info">
        <i class="material-icons-outlined">info</i>
        <span>No completed jobs yet.</span>
      </div>
    <% } %>
  </div>
  </div>
  <script>
    var drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
    var topAppBar = mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('.mdc-top-app-bar'));
    topAppBar.setScrollTarget(document.querySelector('.page'));
    topAppBar.listen('MDCTopAppBar:nav', function() {
      drawer.open = !drawer.open;
    });
    if (window.innerWidth >= 993) drawer.open = true;
  </script>
</body>
</html>
