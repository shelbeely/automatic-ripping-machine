<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title : 'ARM - MCP Apps' %></title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <%- include('nav') %>
  <div class="container-fluid mt-3">
    <h2>MCP Apps</h2>
    <p class="text-muted">
      ARM uses the <a href="https://modelcontextprotocol.io" target="_blank">Model Context Protocol (MCP)</a>
      to connect to external tool servers â€” media databases, file organizers, metadata providers, and more.
    </p>

    <div class="row mt-3">
      <div class="col-md-4">
        <div class="card">
          <div class="card-body text-center">
            <h5 class="card-title">Configured</h5>
            <p class="display-6"><%= configuredCount %></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body text-center">
            <h5 class="card-title">Connected</h5>
            <p class="display-6 <%= connectedCount > 0 ? 'text-success' : 'text-muted' %>"><%= connectedCount %></p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body text-center">
            <h5 class="card-title">Tools Available</h5>
            <p class="display-6"><%= tools.length %></p>
          </div>
        </div>
      </div>
    </div>

    <% if (configs.length > 0) { %>
      <div class="card mt-4">
        <div class="card-header"><h5>Configured MCP Apps</h5></div>
        <div class="card-body">
          <table class="table table-striped">
            <thead>
              <tr><th>Name</th><th>Transport</th><th>Command / URL</th></tr>
            </thead>
            <tbody>
              <% configs.forEach(function(cfg) { %>
                <tr>
                  <td><%= cfg.name %></td>
                  <td><%= cfg.command ? 'stdio' : 'http' %></td>
                  <td><code><%= cfg.command ? (cfg.command + ' ' + (cfg.args || []).join(' ')) : cfg.url %></code></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    <% } %>

    <% if (tools.length > 0) { %>
      <div class="card mt-4">
        <div class="card-header"><h5>Available Tools</h5></div>
        <div class="card-body">
          <table class="table table-striped">
            <thead>
              <tr><th>App</th><th>Tool</th><th>Description</th></tr>
            </thead>
            <tbody>
              <% tools.forEach(function(tool) { %>
                <tr>
                  <td><span class="badge bg-primary"><%= tool.appName %></span></td>
                  <td><code><%= tool.name %></code></td>
                  <td><%= tool.description || '' %></td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    <% } else if (configs.length === 0) { %>
      <div class="alert alert-info mt-4">
        <h5>No MCP Apps Configured</h5>
        <p>Add MCP app servers to your <code>arm.yaml</code> configuration to extend ARM with external tools:</p>
        <pre><code>MCP_APPS:
  - name: media-db
    command: npx
    args: ["-y", "@some/mcp-media-server"]
  - name: file-organizer
    command: node
    args: ["path/to/server.js"]</code></pre>
      </div>
    <% } %>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
