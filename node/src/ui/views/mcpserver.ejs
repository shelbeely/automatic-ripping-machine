<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= typeof title !== 'undefined' ? title : 'ARM - MCP Server' %></title>
  <%- include('head') %>
</head>
<body class="dark">
  <%- include('nav') %>
  <div class="page">
    <h5>MCP Server</h5>
    <p>
      ARM exposes its capabilities via the
      <a href="https://modelcontextprotocol.io" target="_blank">Model Context Protocol (MCP)</a>.
      External apps and AI assistants can connect to this server to interact with ARM's ripping pipeline,
      AI agents, job management, and system information.
    </p>

    <div class="grid">
      <div class="s6 m3">
        <div class="md3-card" style="text-align:center;">
          <h6 class="md-typescale-title-medium">Server</h6>
          <p class="md-typescale-display-small"><%= serverInfo.name %></p>
        </div>
      </div>
      <div class="s6 m3">
        <div class="md3-card" style="text-align:center;">
          <h6 class="md-typescale-title-medium">Version</h6>
          <p class="md-typescale-display-small"><%= serverInfo.version %></p>
        </div>
      </div>
      <div class="s6 m3">
        <div class="md3-card" style="text-align:center;">
          <h6 class="md-typescale-title-medium">Tools</h6>
          <p class="md-typescale-display-small"><%= tools.length %></p>
        </div>
      </div>
      <div class="s6 m3">
        <div class="md3-card" style="text-align:center;">
          <h6 class="md-typescale-title-medium">Resources</h6>
          <p class="md-typescale-display-small"><%= resources.length %></p>
        </div>
      </div>
    </div>

    <h6 style="margin-top:1.5rem;">Connection Info</h6>
    <div class="md3-card">
      <p><strong>Endpoint:</strong> <code>/mcp/message</code> (JSON-RPC 2.0 POST)</p>
      <p><strong>SSE Stream:</strong> <code>/mcp/sse</code> (Server-Sent Events GET)</p>
      <p><strong>Discovery:</strong> <code>/mcp</code> (JSON GET)</p>
      <p><strong>Protocol Version:</strong> <code><%= protocolVersion %></code></p>
    </div>

    <h6 style="margin-top:1.5rem;">Available Tools (<%= tools.length %>)</h6>
    <div class="mdc-data-table" style="width:100%;">
      <div class="mdc-data-table__table-container">
        <table class="mdc-data-table__table" aria-label="MCP Tools">
          <thead>
            <tr class="mdc-data-table__header-row">
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Tool Name</th>
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Description</th>
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Parameters</th>
            </tr>
          </thead>
          <tbody class="mdc-data-table__content">
            <% tools.forEach(function(tool) { %>
              <tr class="mdc-data-table__row">
                <td class="mdc-data-table__cell"><code><%= tool.name %></code></td>
                <td class="mdc-data-table__cell"><%= tool.description %></td>
                <td class="mdc-data-table__cell">
                  <% if (tool.inputSchema && tool.inputSchema.properties) { %>
                    <% Object.keys(tool.inputSchema.properties).forEach(function(param) { %>
                      <code><%= param %></code><% if (tool.inputSchema.required && tool.inputSchema.required.includes(param)) { %>*<% } %><br>
                    <% }); %>
                  <% } else { %>
                    â€”
                  <% } %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>

    <h6 style="margin-top:1.5rem;">Available Resources (<%= resources.length %>)</h6>
    <div class="mdc-data-table" style="width:100%;">
      <div class="mdc-data-table__table-container">
        <table class="mdc-data-table__table" aria-label="MCP Resources">
          <thead>
            <tr class="mdc-data-table__header-row">
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">URI</th>
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Name</th>
              <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Description</th>
            </tr>
          </thead>
          <tbody class="mdc-data-table__content">
            <% resources.forEach(function(r) { %>
              <tr class="mdc-data-table__row">
                <td class="mdc-data-table__cell"><code><%= r.uri %></code></td>
                <td class="mdc-data-table__cell"><%= r.name %></td>
                <td class="mdc-data-table__cell"><%= r.description %></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </div>
  <script>
    var drawer = mdc.drawer.MDCDrawer.attachTo(document.querySelector('.mdc-drawer'));
    var topAppBar = mdc.topAppBar.MDCTopAppBar.attachTo(document.querySelector('.mdc-top-app-bar'));
    topAppBar.setScrollTarget(document.querySelector('.page'));
    topAppBar.listen('MDCTopAppBar:nav', function() {
      drawer.open = !drawer.open;
    });
    if (window.innerWidth >= 993) drawer.open = true;
  </script>
</body>
</html>
